## Admin Backend 개발 목표
- Spring Security 적용
- JWT 기반 로그인 구현

## 구현 상세

### 1. Spring Security 기본 설정
**목표**: Spring Security 및 JWT 인증 기반 구축

**구현 사항**:
- Spring Security 의존성 추가
- JWT Filter 구현 (jjwt 의존성 추가)
- 401 Unauthorized 처리 (JWT 관련, 표준 응답)
- 403 Forbidden 처리 (Role 관련, 표준 응답)
- JWT Claims: id, userid, name, role
- Refresh Token 미사용
- 토큰 유효시간: 1시간 (application.properties)
- SecurityTestController, SecurityTestControllerTest 구현
- @Service @WithMockUser로 ADMIN, USER 권한 테스트
- @Controller Test는 test용 jwt token 함수를 통해 헤더에 포함시켜서 테스트 시킨다.(사용자 정보 포함되어야함.)

**검증**: gradle test

### 2. User API 보안 적용
**목표**: 기존 User API에 Spring Security 적용

**구현 사항**:
- 테스트용 코드 제거
- "/api/v1/**" 경로에 USER 롤 필수
- 테스트 코드에 롤 권한 적용

**검증**: gradle test

### 3. Password Encoder 적용
**목표**: 패스워드 암호화 처리

**구현 사항**:
- 기존 User API 리팩토링
- DelegatingPasswordEncoder 사용
- src/test/resources/db/01.data.sql 테스트 데이터 추가:
  - userid: admin, name: 관리자, password: {noop}admin, role: ADMIN
  - userid: user, name: 사용자, password: {noop}user, role: USER
- User 테스트 코드 리팩토링 (빈 테이블 → 초기 데이터 2건)

**검증**: gradle test

### 4. Login API 개발
**목표**: JWT 토큰 발급 로그인 API

**구현 사항**:
- POST /api/v1/login (permitAll)
- 토큰 유효시간: 1시간 (application.properties)
- LoginController, LoginControllerTest 구현
- 로그인 테스트 케이스 작성
- JWT 토큰 검증 테스트 작성

**검증**: gradle test

### 5. Refresh Token 구현
**목표**: Access Token 및 Refresh Token 이중 토큰 시스템 구축

**구현 사항**:
- Access Token 유효시간: 24시간 변경
- Refresh Token 도입 (유효시간: 1개월)
- Refresh Token 저장을 위한 DB 테이블 추가 (refresh_tokens)
- POST /api/v1/refresh - Refresh Token으로 새 Access Token 발급
- POST /api/v1/logout - Refresh Token 무효화
- RefreshTokenService 구현
- RefreshTokenController, RefreshTokenControllerTest 구현
- 토큰 갱신 테스트 케이스 작성

**검증**: gradle test

### 6. JWT 토큰 구조 및 서비스 구분

**JWT Token Claims 구조**:
```json
{
  "id": 1,                        // 사용자 고유 ID
  "userid": "admin",             // 로그인 ID
  "name": "관리자",               // 사용자 이름
  "role": "ADMIN",               // 권한 (ADMIN, USER)
  "iss": "kta-portal-admin",    // 발급자 (서비스 구분)
  "iat": 1737626400,             // 발급 시간
  "exp": 1737712800              // 만료 시간
}
```

**서비스별 Issuer 구분**:
- `kta-portal-admin`: 관리자 포털 (현재 구현)
- `kta-portal-school`: 학교 포털
- `kta-portal-front`: 일반 사용자 포털
- `kta-portal-api`: API 서비스

**Token 유효 시간**:
- Access Token: 24시간 (86400000ms)
- Refresh Token: 30일 (2592000000ms)

**활용 방안**:
- 각 서비스별로 독립적인 토큰 발급 및 관리
- `iss` 클레임으로 토큰 출처 확인 및 서비스간 인증
- 중앙 인증 서버 구축시 통합 관리 가능

**검증**: gradle test

### 7. Issuer 기반 토큰 검증 시스템

**목표**: JWT 토큰의 issuer 클레임을 통한 서비스 구분 및 보안 강화

**구현 사항**:
- JwtTokenProvider에 issuer 클레임 추가
- 토큰 검증시 issuer 확인 로직 구현
- 다른 서비스 토큰 자동 거부
- JwtTokenProviderTest: issuer 검증 테스트 11개
- JwtAuthenticationFilterTest: 인증 필터 테스트 7개
- LoginControllerTest: 로그인 토큰 issuer 검증 추가

**보안 효과**:
- 서비스간 토큰 격리로 보안 강화
- 토큰 출처 추적 가능
- 중앙 인증 서버 구축시 서비스 구분 기반

**검증**: gradle test (JWT 관련 테스트 18개 통과)



# Design Rule
KISS, DRY, YAGNI

# HeadVer 0.2539.9: Development cycle

- **Developer(s)**: boojongmin
- **Started**: 2025-09-23 (Week 38)
- **Completed**: [To be filled]
- **Status**: Development
- **Dependencies**: 0.2539.8
- **Head Category**: [To be determined]
- **Build**: 9

## Current Development Environment
- **HeadVer**: 0.2539.9
- **Worktree**: /Users/bjm/.claude/prompt_helper/worktree/kta-portal-project/0.2539.9
- **Branch**: 0.2539.9
- **Description**: Development cycle
